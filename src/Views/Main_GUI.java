package Views;

import org.math.plot.*;
import sistemassegundoorden.*;
/*
 * @author loli,mario
 */

public class Main_GUI extends javax.swing.JFrame {

    private int runSeconds;
    private CalculoParametros param_calc;
    private Parametros parametros;
    private double[] x;
    private double[] y;
    // private Plot2DPanel plot = new Plot2DPanel();
    private int systemType;
    private int tamVectorDatos;
    Plot2DPanel plot = new Plot2DPanel();

    public Main_GUI() {
        initComponents();
        runSeconds = 5;
        tamVectorDatos = 51;
        createVector();
    }

    private void createVector() {
        x = new double[tamVectorDatos];
        y = new double[tamVectorDatos];
    }

    public void plotResult() {
        int cont = 0;
        double t;
        /*if (JOptionPane.showConfirmDialog(this,"¿Desea limpiar la gráfica para el nuevo resultado?\nEsto descartá resultados anteriores","Limpiar gráfica",JOptionPane.YES_NO_OPTION,JOptionPane.QUESTION_MESSAGE)==JOptionPane.YES_OPTION){
         plot.removeAllPlots();
         }*/
        switch (systemType) {
            case 1:
                //Sistema subamortiguado
                Subamortiguado sub_amor = new Subamortiguado(parametros.getWn(), parametros.getChi());
                for (t = 0; t < runSeconds; t = t + 0.1) {
                    x[cont] = t;
                    //System.out.println(sub_amor.ftct(t));
                    y[cont] = sub_amor.ftct(t);
                    cont++;
                }
                break;
            case 2:
                //Sistema criticamente amortiguado
                AmortiguamientoCritico critico = new AmortiguamientoCritico(parametros.getWn());
                for (t = 0; t < runSeconds; t = t + 0.1) {
                    x[cont] = t;
                    //System.out.println(sub_amor.ftct(t));
                    y[cont] = critico.ftct(t);
                    cont++;
                }
                break;
            case 3:
                //Sistema sobreamortiguado
                Sobreamortiguado sobre = new Sobreamortiguado(parametros.getChi(), parametros.getWn());
                for (t = 0; t < runSeconds; t = t + 0.1) {
                    x[cont] = t;
                    //System.out.println(sub_amor.ftct(t));
                    y[cont] = sobre.ftct(t);
                    cont++;
                }
                break;

        }
        // add a line plot to the PlotPanel
        plot.addLinePlot("my plot", x, y);
        plotFrame.setContentPane(plot);
        plotFrame.setVisible(true);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jTabbedPane1 = new javax.swing.JTabbedPane();
        panelParams = new javax.swing.JPanel();
        labelType = new javax.swing.JLabel();
        spinnerTime = new javax.swing.JSpinner();
        labelTime = new javax.swing.JLabel();
        labelResultados = new javax.swing.JLabel();
        scrollResultados = new javax.swing.JScrollPane();
        textResultados = new javax.swing.JTextArea();
        btnRun = new javax.swing.JButton();
        labelExample = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        textNumerador = new javax.swing.JTextField();
        textT2 = new javax.swing.JTextField();
        panelGraphics = new javax.swing.JPanel();
        plotFrame = new javax.swing.JInternalFrame();
        btnClearPlots = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Sistemas de segundo orden");
        setAlwaysOnTop(true);

        labelType.setText("Coeficientes");

        spinnerTime.setName("spinnerTime"); // NOI18N
        spinnerTime.setValue(5);
        spinnerTime.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                spinnerTimeStateChanged(evt);
            }
        });

        labelTime.setText("Tiempo (s):");

        labelResultados.setText("Resultados");

        textResultados.setEditable(false);
        textResultados.setColumns(20);
        textResultados.setRows(5);
        scrollResultados.setViewportView(textResultados);

        btnRun.setText("Comenzar");
        btnRun.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRunActionPerformed(evt);
            }
        });

        labelExample.setIcon(new javax.swing.ImageIcon(getClass().getResource("/resources/example.png"))); // NOI18N

        jLabel1.setText("Numerador:");

        jLabel4.setText("Primer grado:");

        textNumerador.setText("1.0");

        textT2.setText("1.0");

        javax.swing.GroupLayout panelParamsLayout = new javax.swing.GroupLayout(panelParams);
        panelParams.setLayout(panelParamsLayout);
        panelParamsLayout.setHorizontalGroup(
            panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelParamsLayout.createSequentialGroup()
                .addGap(27, 27, 27)
                .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(labelType)
                    .addGroup(panelParamsLayout.createSequentialGroup()
                        .addGap(23, 23, 23)
                        .addComponent(labelExample))
                    .addGroup(panelParamsLayout.createSequentialGroup()
                        .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4)
                            .addComponent(jLabel1)
                            .addComponent(labelTime))
                        .addGap(21, 21, 21)
                        .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(panelParamsLayout.createSequentialGroup()
                                .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(textNumerador, javax.swing.GroupLayout.DEFAULT_SIZE, 49, Short.MAX_VALUE)
                                    .addComponent(textT2, javax.swing.GroupLayout.Alignment.TRAILING))
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addGroup(panelParamsLayout.createSequentialGroup()
                                .addComponent(spinnerTime, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, panelParamsLayout.createSequentialGroup()
                        .addComponent(btnRun)
                        .addGap(129, 129, 129)))
                .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(panelParamsLayout.createSequentialGroup()
                        .addGap(55, 55, 55)
                        .addComponent(labelResultados))
                    .addGroup(panelParamsLayout.createSequentialGroup()
                        .addGap(43, 43, 43)
                        .addComponent(scrollResultados, javax.swing.GroupLayout.PREFERRED_SIZE, 402, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        panelParamsLayout.setVerticalGroup(
            panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelParamsLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(labelType)
                    .addComponent(labelResultados))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(panelParamsLayout.createSequentialGroup()
                        .addComponent(labelExample)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel1)
                            .addComponent(textNumerador, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel4)
                            .addComponent(textT2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(26, 26, 26)
                        .addGroup(panelParamsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(labelTime)
                            .addComponent(spinnerTime, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(33, 33, 33)
                        .addComponent(btnRun))
                    .addComponent(scrollResultados, javax.swing.GroupLayout.PREFERRED_SIZE, 205, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(38, Short.MAX_VALUE))
        );

        jTabbedPane1.addTab("Parámetros", panelParams);

        plotFrame.setVisible(true);

        javax.swing.GroupLayout plotFrameLayout = new javax.swing.GroupLayout(plotFrame.getContentPane());
        plotFrame.getContentPane().setLayout(plotFrameLayout);
        plotFrameLayout.setHorizontalGroup(
            plotFrameLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );
        plotFrameLayout.setVerticalGroup(
            plotFrameLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 231, Short.MAX_VALUE)
        );

        btnClearPlots.setText("Limpiar");
        btnClearPlots.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnClearPlotsActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout panelGraphicsLayout = new javax.swing.GroupLayout(panelGraphics);
        panelGraphics.setLayout(panelGraphicsLayout);
        panelGraphicsLayout.setHorizontalGroup(
            panelGraphicsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(plotFrame)
            .addGroup(panelGraphicsLayout.createSequentialGroup()
                .addComponent(btnClearPlots)
                .addGap(0, 677, Short.MAX_VALUE))
        );
        panelGraphicsLayout.setVerticalGroup(
            panelGraphicsLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelGraphicsLayout.createSequentialGroup()
                .addComponent(plotFrame)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnClearPlots))
        );

        jTabbedPane1.addTab("Gráficas", panelGraphics);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jTabbedPane1)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 317, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void spinnerTimeStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_spinnerTimeStateChanged
        if ((int) spinnerTime.getValue() < 1) {
            spinnerTime.setValue(1);
        }
    }//GEN-LAST:event_spinnerTimeStateChanged

    private void btnRunActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRunActionPerformed
        //Obtenemos los segundos que se correrá
        this.runSeconds = (int) spinnerTime.getValue();
        tamVectorDatos = (int) (runSeconds / 0.1 + 1); //datos a guardar para graficar
        createVector();
        try {
            parametros = new Parametros(Double.parseDouble(textNumerador.getText()), Double.parseDouble(textT2.getText()));
            param_calc = new CalculoParametros(parametros);
            textResultados.setText(
                      "Frecuencia natural amortiguada (Wd): " + parametros.getWd() + "\n"
                    + "Frecuencia natural no amortiguada (Wn): " + parametros.getWn() + "\n"
                    + "Factor de amortiguamiento (Zeta): " + parametros.getChi() + "\n"
                    + "Atenuación (Sigma): " + parametros.getSigma() + "\n\n"
                    + "Por lo tanto se trata de un " + param_calc.getResult());
            systemType = param_calc.getType();
            plotResult();
        } catch (Exception ex) {
            textResultados.setText("Error: " + ex.getLocalizedMessage());
        }
    }//GEN-LAST:event_btnRunActionPerformed

    private void btnClearPlotsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnClearPlotsActionPerformed
        plot.removeAllPlots();
    }//GEN-LAST:event_btnClearPlotsActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(Main_GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(Main_GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(Main_GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(Main_GUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new Main_GUI().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnClearPlots;
    private javax.swing.JButton btnRun;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JLabel labelExample;
    private javax.swing.JLabel labelResultados;
    private javax.swing.JLabel labelTime;
    private javax.swing.JLabel labelType;
    private javax.swing.JPanel panelGraphics;
    private javax.swing.JPanel panelParams;
    private javax.swing.JInternalFrame plotFrame;
    private javax.swing.JScrollPane scrollResultados;
    private javax.swing.JSpinner spinnerTime;
    private javax.swing.JTextField textNumerador;
    private javax.swing.JTextArea textResultados;
    private javax.swing.JTextField textT2;
    // End of variables declaration//GEN-END:variables
}
